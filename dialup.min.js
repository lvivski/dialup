!function(e){"use strict";function n(e,n){function t(e,n){n.createOffer(function(t){n.setLocalDescription(t),p("offer",{id:parseInt(e),description:{sdp:t.sdp,type:t.type}})},function(){})}function c(e,n){n.createAnswer(function(t){n.setLocalDescription(t),p("answer",{id:e,description:{sdp:t.sdp,type:t.type}})},function(){})}function f(e,n,t){var i=n.createDataChannel(t||"fileTransfer",{reliable:!1});u(e,i)}function u(e,n){n.onopen=function(){},n.onmessage=function(n){C.add({type:"data",id:e,data:n.data})},n.onclose=function(){},y[e]=n}function l(e){var n=new i({iceServers:[{url:"stun:stun.l.google.com:19302"}]},{optional:[{RtpDataChannels:!0},{DtlsSrtpKeyAgreement:!0}]});return n.onicecandidate=function(n){null!=n.candidate&&p("candidate",{label:n.candidate.sdpMLineIndex,id:e,candidate:n.candidate.candidate})},n.onaddstream=function(n){C.add({type:"add",id:e,stream:n.stream})},n.onremovestream=function(n){C.add({type:"remove",id:e,stream:n.stream})},n.ondatachannel=function(n){u(e,n.channel)},n}function p(e,n){n.type=e,R.send(JSON.stringify(n))}var m=null,v=[],h={},y={},w=[],C=new d,R=new WebSocket(e);R.onopen=function(){p("join",{room:n||""})},R.onerror=function(){},R.onmessage=function(e){C.add(JSON.parse(e.data))},this.onOffer=C.filter(function(e){return"offer"===e.type}),this.onAnswer=C.filter(function(e){return"answer"===e.type}),this.onCandidate=C.filter(function(e){return"candidate"===e.type}),this.onNew=C.filter(function(e){return"new"===e.type}),this.onPeers=C.filter(function(e){return"peers"===e.type}),this.onLeave=C.filter(function(e){return"leave"===e.type}),this.onAdd=C.filter(function(e){return"add"===e.type}),this.onRemove=C.filter(function(e){return"remove"===e.type}),this.onData=C.filter(function(e){return"data"===e.type}),this.send=function(e){for(var n in y){var t=y[n];t.send(e)}},this.createStream=function(e,n){var i=new s;return o({audio:e,video:n},function(e){w.push(e);for(var n=0;n<v.length;++n){var o=v[n];h[o]=l(o)}for(n=0;n<w.length;++n){var e=w[n];for(var o in h){var r=h[o];r.addStream(e)}}for(o in h)r=h[o],f(o,r),t(o,r);i.fulfill(e)},function(){}),i},this.onPeers.listen(function(e){m=parseInt(e.you,10);for(var n in e.connections){var t=e.connections[n];v.push(t)}}),this.onCandidate.listen(function(e){var n=new r({sdpMLineIndex:e.label,candidate:e.candidate});h[e.id].addIceCandidate(n)}),this.onNew.listen(function(e){var n=e.id,t=l(n);v.push(n),h[n]=t,w.forEach(function(e){t.addStream(e)})}),this.onLeave.listen(function(e){var n=e.id;delete h[n],delete y[n],delete v[n]}),this.onOffer.listen(function(e){var n=h[e.id];n.setRemoteDescription(new a(e.description)),c(e.id,n)}),this.onAnswer.listen(function(e){var n=h[e.id];n.setRemoteDescription(new a(e.description))})}var t=e.navigator,i=e.PeerConnection||e.webkitPeerConnection00||e.webkitRTCPeerConnection||e.mozRTCPeerConnection,o=(t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia||noop).bind(t),r=e.mozRTCIceCandidate||e.RTCIceCandidate,a=e.mozRTCSessionDescription||e.RTCSessionDescription;e.URL=e.URL||e.webkitURL||e.msURL;var d,s;"function"==typeof define&&define.amd?define(["streamlet","davy"],function(e,t){return d=e,s=t,n}):"object"==typeof module&&module.exports?(module.exports=n,d=require("streamlet"),s=require("davy")):(e.Dialup=n,d=e.Stream,s=e.Promise)}(this);
//# sourceMappingURL=dialup.min.js.map