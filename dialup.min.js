!function(e){"use strict";var l,p;function o(e){return e.replace(/^stun:stun\d*\./,"").replace(/:\d+$/,"")}function c(e,n){const t=l.control(),o=t.stream,i=new WebSocket(e);function c(e,n){n.type=e,i.send(JSON.stringify(n))}i.onopen=function(){c("join",{room:n||""})},i.onerror=function(){},i.onmessage=function(e){t.add(JSON.parse(e.data))},this.send=c,this.onJoin=o.filter(e=>"join"===e.type),this.onOffer=o.filter(e=>"offer"===e.type),this.onAnswer=o.filter(e=>"answer"===e.type),this.onCandidate=o.filter(e=>"candidate"===e.type),this.onNew=o.filter(e=>"new"===e.type),this.onPeers=o.filter(e=>"peers"===e.type),this.onLeave=o.filter(e=>"leave"===e.type)}"Window"!=typeof e&&(e=window),"function"==typeof define&&define.amd?define(["streamlet","overtone"],function(e,n){return l=e,p=n,t}):p="object"==typeof module&&module.exports?(module.exports=t,l=require("streamlet"),require("overtone")):(e.Dialup=t,l=e.Streamlet,e.Overtone),e=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.rixtelecom.se","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"].reduce(function(e,n){var t=e[e.length-1];return n="stun:"+n,t&&o(t.urls[0])===o(n)?t.urls.push(n):e.push({urls:[n]}),e},[]);const h={offerToReceiveAudio:!0,offerToReceiveVideo:!0},m={iceServers:e};function t(e,n){const s=new c(e,n),a=[],r={},o={},d=[],t=l.control(),i=t.stream;function u(n,e){e.onopen=function(){},e.onmessage=function(e){t.add({id:n,type:"data",data:e.data})},e.onclose=function(){},o[n]=e}function f(n){const e=new RTCPeerConnection(m);return e.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&s.send("candidate",{id:n,candidate:e.candidate})},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"disconnected":case"failed":e.close();break;case"completed":e.onicecandidate=function(){}}},e.onicecandidateerror=function(e){console.log(e)},e.ontrack=function(e){t.add({id:n,type:"add",stream:e.streams[0]})},e.ondatachannel=function(e){u(n,e.channel)},e}this.onAdd=i.filter(e=>"add"===e.type),this.onData=i.filter(e=>"data"===e.type),this.onPeers=s.onPeers,this.onLeave=s.onLeave,this.broadcast=function(e){for(const n in o)this.send(n,e)},this.send=function(e,n){const t=o[e];"open"===t.readyState&&t.send(n)},this.createStream=function(e,n){return navigator.mediaDevices.getUserMedia({audio:e,video:n}).then(function(n){p.filter(n),d.push(n);for(const i of a){const c=r[i]=f(i);for(const n of d)n.getTracks().forEach(function(e){c.addTrack(e,n)});e=i,t=c,o=(o=void 0)||"dataChannel",o=t.createDataChannel(o),!void u(e,o),function(e,n){n.createOffer(h).then(e=>n.setLocalDescription(e)).then(()=>s.send("offer",{id:e,description:n.localDescription}),function(){})}(i,c)}var e,t,o;return n})},s.onPeers.listen(function(e){e.you;for(const n of e.connections)a.push(n)}),s.onCandidate.listen(function(e){var n=e.id;r[n].addIceCandidate(e.candidate)}),s.onNew.listen(function(e){e=e.id;const t=f(e);a.push(e),r[e]=t,d.forEach(function(n){n.getTracks().forEach(function(e){t.addTrack(e,n)})})}),s.onLeave.listen(function(e){e=e.id;delete r[e],delete o[e],a.splice(a.indexOf(e),1)}),s.onOffer.listen(function(e){var n,t,o=e.id;const i=r[o];i.setRemoteDescription(e.description),n=o,(t=i).createAnswer().then(e=>t.setLocalDescription(e)).then(()=>s.send("answer",{id:n,description:t.localDescription}),function(){})}),s.onAnswer.listen(function(e){var n=e.id;const t=r[n];t.setRemoteDescription(e.description)})}}(this);