!function(e){"use strict";function n(e,n){function t(e,n){n.createOffer(function(t){n.setLocalDescription(t),v("offer",{id:e,description:{sdp:t.sdp,type:t.type}})},function(){},b)}function u(e,n){n.createAnswer(function(t){n.setLocalDescription(t),v("answer",{id:e,description:{sdp:t.sdp,type:t.type}})},function(){})}function l(e,n,t){var i=n.createDataChannel(t||"fileTransfer",{reliable:!1});p(e,i)}function p(e,n){n.onopen=function(){},n.onmessage=function(n){R.add({type:"data",id:e,data:n.data})},n.onclose=function(){},C[e]=n}function m(e){var n=new i(g,k);return n.onicecandidate=function(n){null!=n.candidate&&v("candidate",{label:n.candidate.sdpMLineIndex,id:e,candidate:n.candidate.candidate})},n.onaddstream=function(n){R.add({type:"add",id:e,stream:n.stream})},n.onremovestream=function(n){R.add({type:"remove",id:e,stream:n.stream})},n.ondatachannel=function(n){p(e,n.channel)},n}function v(e,n){n.type=e,T.send(JSON.stringify(n))}var h=null,y=[],w={},C={},S=[],R=new s,T=new WebSocket(e),b={optional:[],mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},g={iceServers:[{url:"stun:stun.l.google.com:19302"}]},k={optional:[{RtpDataChannels:!0},{DtlsSrtpKeyAgreement:!0}]};T.onopen=function(){v("join",{room:n||""})},T.onerror=function(){},T.onmessage=function(e){R.add(JSON.parse(e.data))},this.onOffer=R.filter(function(e){return"offer"===e.type}),this.onAnswer=R.filter(function(e){return"answer"===e.type}),this.onCandidate=R.filter(function(e){return"candidate"===e.type}),this.onNew=R.filter(function(e){return"new"===e.type}),this.onPeers=R.filter(function(e){return"peers"===e.type}),this.onLeave=R.filter(function(e){return"leave"===e.type}),this.onAdd=R.filter(function(e){return"add"===e.type}),this.onRemove=R.filter(function(e){return"remove"===e.type}),this.onData=R.filter(function(e){return"data"===e.type}),this.broadcast=function(e){for(var n in C)this.send(n,e)},this.send=function(e,n){var t=C[e];"open"===t.readyState&&t.send(n)},this.createStream=function(e,n){var i=new f;return o({audio:e,video:n},function(e){if(d){var n=e.getAudioTracks()[0],o=new d,a=new c;a.addTrack(n),e.removeTrack(n);var r=o.createMediaStreamSource(a),s=o.createBiquadFilter(),f=o.createMediaStreamDestination();s.type=s.LOWPASS,s.Q.value=0,s.frequency.value=2e3,r.connect(s),s.connect(f),e.addTrack(f.stream.getAudioTracks()[0])}S.push(e);for(var u=0;u<y.length;++u){var p=y[u];w[p]=m(p)}for(u=0;u<S.length;++u){var e=S[u];for(var p in w){var v=w[p];v.addStream(e)}}for(p in w)v=w[p],l(p,v),t(p,v);i.fulfill(e)},function(){},b),i},this.onPeers.listen(function(e){h=e.you;for(var n in e.connections){var t=e.connections[n];y.push(t)}}),this.onCandidate.listen(function(e){var n=new a({sdpMLineIndex:e.label,candidate:e.candidate});w[e.id].addIceCandidate(n)}),this.onNew.listen(function(e){var n=e.id,t=m(n);y.push(n),w[n]=t,S.forEach(function(e){t.addStream(e)})}),this.onLeave.listen(function(e){var n=e.id;delete w[n],delete C[n],y.splice(y.indexOf(n),1)}),this.onOffer.listen(function(e){var n=w[e.id];n.setRemoteDescription(new r(e.description)),u(e.id,n)}),this.onAnswer.listen(function(e){var n=w[e.id];n.setRemoteDescription(new r(e.description))})}var t=e.navigator,i=e.PeerConnection||e.webkitPeerConnection00||e.webkitRTCPeerConnection||e.mozRTCPeerConnection,o=(t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia||noop).bind(t),a=e.mozRTCIceCandidate||e.RTCIceCandidate,r=e.mozRTCSessionDescription||e.RTCSessionDescription,d=e.AudioContext||e.webkitAudioContext||e.mozAudioContext,c=e.MediaStream||e.webkitMediaStream||e.mozMediaStream;e.URL=e.URL||e.webkitURL||e.msURL;var s,f;"function"==typeof define&&define.amd?define(["streamlet","davy"],function(e,t){return s=e,f=t,n}):"object"==typeof module&&module.exports?(module.exports=n,s=require("streamlet"),f=require("davy")):(e.Dialup=n,s=e.Stream,f=e.Promise)}(this);
//# sourceMappingURL=dialup.min.js.map